{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <link rel="stylesheet" href="{{ base_url }}/css/stars.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Inter:wght@300;400;600;700&display=swap">
  <style>
    body {
      background-color: #000; /* Fallback for when stars don't load */
    }

    /* Transparent header and nav bars */
    .md-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      background-color: transparent !important;
      box-shadow: none !important;
    }
    .md-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 300px; /* Adjust height for desired gradient size */
      background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
      z-index: -1; /* Place it behind the header content */
      pointer-events: none; /* Ensure it doesn't block interactions */
    }

    .md-main__inner {
        margin-top: 0 !important;
    }
    .md-content {
        z-index: 1;
        position: relative;
    }
    .md-header-nav,
    .md-tabs {
      background-color: transparent !important;
    }

    /* Full-screen hero section */
    .home-hero {
      position: relative;
      height: 100vh; /* Full viewport height */
      width: 100vw;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      margin: 0;
      background: transparent;
      overflow: hidden; /* Contain the parallaxing background */
    }

    .hero-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%; /* Adjust for less zoom */
      object-fit: cover;
      z-index: -1;
    }

    .home-hero__inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      z-index: 1;
      transition: transform 0.2s ease-out; /* For parallax */
    }

    .home-hero__inner h1 {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 5rem; /* Larger font for impact */
      color: white;
      text-shadow: 0 5px 25px rgba(0,0,0,0.8); /* Stronger shadow for visibility */
      margin: 0;
      letter-spacing: -0.02em; /* Tighter letter spacing for modern look */
    }

    .home-hero__inner p {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      margin-top: 1rem;
      color: #FFFFFF; /* Brighter text */
      text-shadow: 0 2px 10px rgba(0,0,0,0.5); /* Softer shadow for better contrast */
      max-width: 800px; /* Constrain width for readability */
      line-height: 1.4;
    }

    .hero-text-content p {
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
      margin-top: 0.5rem;
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 1px 5px rgba(0,0,0,0.4);
    }

    .home-hero__cta {
      margin-top: 1.5rem;
    }

    .btn {
      display: inline-block;
      padding: 1rem 2rem; /* Bigger buttons */
      border-radius: 12px; /* More rounded corners */
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      margin: 0 0.5rem;
      border: 2px solid transparent;
      backdrop-filter: blur(10px);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* Scroll-reveal animations */
    .slide-in-bottom {
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }

    .slide-in-bottom.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Section styling */
    section:not(.home-hero) {
      background-color: rgba(25, 30, 45, 0.7); /* Brighter, cooler space color */
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      color: white;
      box-shadow: 0 0 15px rgba(0, 168, 255, 0.2); /* Glow effect */
      border: 1px solid rgba(0, 168, 255, 0.1);
    }

    /* Projects grid */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      padding: 2rem;
    }

    .feature {
      text-align: center;
      color: white;
      background-color: rgba(30, 40, 55, 0.7); /* Brighter, cooler space color */
      padding: 1rem;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 168, 255, 0.15); /* Glow effect */
      border: 1px solid rgba(0, 168, 255, 0.1);
    }

    .feature:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), 0 0 25px rgba(0, 168, 255, 0.4); /* Enhanced glow on hover */
      border-color: rgba(0, 168, 255, 0.4);
    }

    .media-wrapper {
      position: relative;
      padding-top: 56.25%;
      overflow: hidden;
      border-radius: 0.5rem;
    }

    .media-wrapper img,
    .media-wrapper video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Media queries for mobile devices */
    @media (max-width: 768px) {
      .home-hero {
        height: auto;
        min-height: 75vh; /* Taller video on mobile */
      }

      .home-hero__inner {
        padding: 2rem 1rem; /* Better vertical and horizontal spacing on mobile */
      }

      .home-hero__inner h1 {
        font-size: 2.5rem; /* Larger font size for better readability */
        margin-bottom: 1rem; /* Add more space below the heading */
        line-height: 1.2; /* Better line height for mobile */
      }

      .home-hero__inner p {
        font-size: 1.1rem; /* Slightly larger font size */
        margin-top: 1rem; /* More space above the paragraph */
        line-height: 1.5; /* Better line height for readability */
        max-width: 90%; /* Constrain width for better mobile readability */
      }

      .hero-bg {
        position: absolute; /* Disable fixed position on mobile */
        height: 100%; /* Cover the hero area */
      }

      .btn {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
      }

      /* Disable parallax on mobile for performance */
      .home-hero__inner,
      .hero-bg {
        transform: none !important;
      }
    }

    /* Extra small screens (below 480px) */
    @media (max-width: 480px) {
      .home-hero__inner {
        padding: 1.5rem 1rem; /* Adjust padding for very small screens */
      }

      .home-hero__inner h1 {
        font-size: 2rem; /* Adjusted font size for small screens */
        margin-bottom: 0.8rem;
      }

      .home-hero__inner p {
        font-size: 1rem; /* Adjusted font size for small screens */
        margin-top: 0.8rem;
        max-width: 95%; /* More width utilization on small screens */
      }

      .btn {
        padding: 0.8rem 1.5rem;
        font-size: 0.9rem; /* Slightly smaller button text */
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create stars
      const container = document.getElementById('stars-container');
      if (container) {
        for (let i = 0; i < 200; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          const size = Math.random() * 3;
          star.style.width = `${size}px`;
          star.style.height = `${size}px`;
          star.style.top = `${Math.random() * 100}%`;
          star.style.left = `${Math.random() * 100}%`;
          star.style.animationDuration = `${Math.random() * 5 + 2}s`;
          star.style.animationDelay = `${Math.random() * 3}s`;
          container.appendChild(star);
        }
      }

      // Add playing property to HTMLMediaElement
      Object.defineProperty(HTMLMediaElement.prototype, 'playing', {
        get: function() {
          return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);
        }
      });

      const video = document.querySelector('.hero-bg');
      if (video) {
        // Attempt to play the video on load
        video.play().catch(error => {
          console.log('Autoplay prevented:', error);
        });

        // Add event listener for suspend event (optional UI trigger)
        video.addEventListener('suspend', () => {
          console.log('Video suspended, awaiting user interaction');
        });

        // Add event listener for play event (optional UI cleanup)
        video.addEventListener('play', () => {
          console.log('Video playing');
        });

        // Play video on first user interaction with the page
        document.body.addEventListener('click', function handler() {
          if (!video.playing) {
            video.play().catch(error => {
              console.log('Manual play failed:', error);
            });
          }
          // Remove listener after first interaction
          document.body.removeEventListener('click', handler);
        });
      }

      // Parallax effect
      window.addEventListener('scroll', function() {
        const heroContent = document.querySelector('.home-hero__inner');
        const heroBg = document.querySelector('.hero-bg');
        const scrollPosition = window.pageYOffset;

        if (heroContent) {
          heroContent.style.transform = `translateY(${scrollPosition * -0.3}px)`;
        }
        if (heroBg) {
          heroBg.style.transform = `translateY(${scrollPosition * 0.5}px)`;
        }
      });

      // Scroll reveal animations
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.01 });
      document.querySelectorAll('.slide-in-bottom').forEach(el => observer.observe(el));
    });
  </script>
{% endblock %}

{% block hero %}
  <div id="stars-container"></div>
  <!-- HERO with video background -->
  <section class="home-hero">
    <video class="hero-bg" autoplay muted loop playsinline preload="auto" poster="{{ base_url }}/assets/images/hotfire-fallback.jpg">
      <source src="{{ base_url }}/assets/videos/hotfirevertical.mp4" type="video/mp4" media="(max-width: 768px)">
      <source src="{{ base_url }}/assets/videos/hotfire.mp4" type="video/mp4">
    </video>

    <div class="home-hero__inner">
        <h1>TMU Rocketry</h1>
        <p>student built liquid propulstion systems, advanced avionics, high quality research</p>
    </div>
  </section>
{% endblock %}

{% block content %}
  <!-- About Section -->
  <section class="about slide-in-bottom">
    <div class="md-container md-typeset">
      <h2>About TMU Rocketry</h2>
      <p>TMU Rocketry is a student-led group dedicated to aerospace innovation. We design and build flight computers, ground station software, and conduct both hot-fire and cold-flow rocket testsâ€”producing technical reports that advance our field.</p>
      <p>Our projects span from circuit design for avionics, data acquisition during engine tests, to mission control software for high-altitude flights. TMU Rocketry provides hands-on aerospace experience for students passionate about propulsion and avionics.</p>
      <div class="home-hero__cta" style="margin-top: 2rem; text-align: center;">
        <a href="{{ 'https://discord.gg/3kak7Ydu43' | url }}" class="btn btn-primary" style="background-color: #00A8FF; color: white;">Discord</a>
        <a href="{{ 'https://forms.gle/A2SYP1yG9MBLYpoK9' | url }}" class="btn btn-primary" style="background-color: #34495E; color: white;">Join Our Team</a>
        {% if config.repo_url %}<a href="{{ config.repo_url }}" class="btn btn-secondary" style="background-color: #2C3E50; color: white;">GitHub</a>{% endif %}
      </div>
    </div>
  </section>

  <!-- Video Showcase Section -->
  <section class="video-showcase slide-in-bottom">
    <div class="md-container md-typeset">
      <h2>Injector testing</h2>
      <div class="video-container" style="position: relative; overflow: hidden; border-radius: 10px; margin: 1rem 0;">
        <video class="showcase-video" autoplay muted loop playsinline preload="auto" poster="{{ base_url }}/assets/images/showcase-fallback.jpg" style="width: 100%; height: auto; border-radius: 10px;">
          <source src="{{ base_url }}/assets/videos/coldflow1.mp4" type="video/mp4">
        </video>
      </div>
      <p>Testing Injector.</p>
    </div>
  </section>

  {% endblock %}