{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <link rel="stylesheet" href="{{ base_url }}/css/stars.css">
  <style>
    body {
      background-color: #000; /* Fallback for when stars don't load */
    }

    /* Transparent header and nav bars */
    .md-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      background-color: transparent !important;
      box-shadow: none !important;
    }
    .md-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 200px; /* Adjust height for desired gradient size */
      background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
      z-index: -1; /* Place it behind the header content */
      pointer-events: none; /* Ensure it doesn't block interactions */
    }

    .md-main__inner {
        margin-top: 0 !important;
    }
    .md-header-nav,
    .md-tabs {
      background-color: transparent !important;
    }

    /* Full-screen hero section */
    .home-hero {
      position: relative;
      height: 100vh; /* Full viewport height */
      width: 100vw;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      margin: 0;
      background: transparent;
      overflow: hidden;
    }

    .hero-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .home-hero__inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      z-index: 1;
    }

    .hero-text-content {
      background-color: rgba(10, 5, 25, 0.75); /* Dark purple/blue tint */
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      color: white;
    }

    .hero-text-content h1 {
      color: white;
      font-size: 2.5rem;
    }

    .home-hero__cta {
      margin-top: 1rem;
    }

    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      border-radius: 0.25rem;
      text-decoration: none;
      font-weight: 500;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* Scroll-reveal animations */
    .slide-in-bottom {
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }

    .slide-in-bottom.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Section styling */
    section:not(.home-hero) {
      background-color: rgba(20, 15, 40, 0.6); /* Darker, more opaque purple */
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      color: white;
    }

    /* Projects grid */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      padding: 2rem;
    }

    .feature {
      text-align: center;
      color: white;
      background-color: rgba(30, 25, 50, 0.7); /* Matching feature background */
      padding: 1rem;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .feature:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    .media-wrapper {
      position: relative;
      padding-top: 56.25%;
      overflow: hidden;
      border-radius: 0.5rem;
    }

    .media-wrapper img,
    .media-wrapper video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Media queries for mobile devices */
    @media (max-width: 768px) {

      /* Hero section adjustments */
      .home-hero {
        min-height: 50vh;
        /* Reduced height for mobile */
        flex-direction: column;
        /* Stack video and text vertically */
        padding: 0.5rem;
        /* Reduced padding */
      }

      .hero-bg {
        position: relative;
        width: 100%;
        height: auto;
        border-radius: 10px;
      }

      .home-hero__inner {
        padding: 0.5rem;
        /* Reduced padding */
        flex-direction: column;
        align-items: center;
      }

      .hero-text-content {
        margin-top: 0.5rem;
        /* Reduced margin */
        padding: 1rem;
        /* Reduced padding */
        width: 100%;
        text-align: center;
      }

      .hero-text-content h1 {
        font-size: 2rem;
      }

      .hero-text-content p {
        font-size: 1rem;
      }

      /* Projects section */
      .features {
        grid-template-columns: 1fr;
        /* Single column layout */
        padding: 0.5rem;
        /* Reduced padding */
        gap: 0.5rem;
        /* Further reduced gap */
      }

      .feature {
        padding: 0.5rem;
        /* Reduced padding */
      }

      .media-wrapper {
        padding-top: 75%;
        /* Adjust aspect ratio for mobile */
      }

      /* General section adjustments */
      section {
        padding: 0.5rem;
        /* Reduced padding */
        margin-bottom: 0.5rem;
        /* Further reduced margin */
      }
    }

    /* Extra small screens (below 480px) */
    @media (max-width: 480px) {
      .hero-text-content h1 {
        font-size: 1.5rem;
      }

      .hero-text-content p {
        font-size: 0.85rem;
      }

      .btn {
        padding: 0.8rem 1.5rem;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create stars
      const container = document.getElementById('stars-container');
      if (container) {
        for (let i = 0; i < 200; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          const size = Math.random() * 3;
          star.style.width = `${size}px`;
          star.style.height = `${size}px`;
          star.style.top = `${Math.random() * 100}%`;
          star.style.left = `${Math.random() * 100}%`;
          star.style.animationDuration = `${Math.random() * 5 + 2}s`;
          star.style.animationDelay = `${Math.random() * 3}s`;
          container.appendChild(star);
        }
      }

      // Add playing property to HTMLMediaElement
      Object.defineProperty(HTMLMediaElement.prototype, 'playing', {
        get: function() {
          return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);
        }
      });

      const video = document.querySelector('.hero-bg');
      if (video) {
        // Attempt to play the video on load
        video.play().catch(error => {
          console.log('Autoplay prevented:', error);
        });

        // Add event listener for suspend event (optional UI trigger)
        video.addEventListener('suspend', () => {
          console.log('Video suspended, awaiting user interaction');
        });

        // Add event listener for play event (optional UI cleanup)
        video.addEventListener('play', () => {
          console.log('Video playing');
        });

        // Play video on first user interaction with the page
        document.body.addEventListener('click', function handler() {
          if (!video.playing) {
            video.play().catch(error => {
              console.log('Manual play failed:', error);
            });
          }
          // Remove listener after first interaction
          document.body.removeEventListener('click', handler);
        });
      }

      // Scroll reveal animations
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.01 });
      document.querySelectorAll('.slide-in-bottom').forEach(el => observer.observe(el));
    });
  </script>
{% endblock %}

{% block hero %}
  <div id="stars-container"></div>
  <!-- HERO with video background -->
  <section class="home-hero">
    <video class="hero-bg" autoplay muted loop playsinline preload="auto" poster="{{ base_url }}/assets/images/hotfire-fallback.jpg">
      <source src="{{ base_url }}/assets/videos/hotfire.mp4" type="video/mp4">
    </video>

    <div class="home-hero__inner">
      <div class="hero-text-content">
        <h1>TMU Rocketry</h1>
        <p>A student team pioneering flight computers, propulsion testing, and ground stations.</p>
      </div>
      <div class="home-hero__cta">
        <a href="{{ 'https://discord.gg/3kak7Ydu43' | url }}" class="btn btn-primary" style="background-color: #5865F2; color: white;">Discord</a>
        <a href="{{ 'https://forms.gle/A2SYP1yG9MBLYpoK9' | url }}" class="btn btn-primary" style="background-color: #7f5ad5; color: white;">Join Our Team</a>
        {% if config.repo_url %}<a href="{{ config.repo_url }}" class="btn btn-secondary" style="background-color: #23272A; color: white;">GitHub</a>{% endif %}
      </div>
    </div>
  </section>
{% endblock %}

{% block content %}
  <!-- About Section -->
  <section class="about slide-in-bottom">
    <div class="md-container md-typeset">
      <h2>About TMU Rocketry</h2>
      <p>TMU Rocketry is a student-led group dedicated to aerospace innovation. We design and build flight computers, ground station software, and conduct both hot-fire and cold-flow rocket testsâ€”producing technical reports that advance our field.</p>
      <p>Our projects span from circuit design for avionics, data acquisition during engine tests, to mission control software for high-altitude flights. TMU Rocketry provides hands-on aerospace experience for students passionate about propulsion and avionics.</p>
    </div>
  </section>

  <!-- Video Showcase Section -->
  <section class="video-showcase slide-in-bottom">
    <div class="md-container md-typeset">
      <h2>Injector testing</h2>
      <div class="video-container" style="position: relative; overflow: hidden; border-radius: 10px; margin: 1rem 0;">
        <video class="showcase-video" autoplay muted loop playsinline preload="auto" poster="{{ base_url }}/assets/images/showcase-fallback.jpg" style="width: 100%; height: auto; border-radius: 10px;">
          <source src="{{ base_url }}/assets/videos/coldflow1.mp4" type="video/mp4">
        </video>
      </div>
      <p>Testing Injector.</p>
    </div>
  </section>

  {% endblock %}